

<!DOCTYPE html>
<html lang="en">

  <head>
    <title>Van Control: Temp and Humidity</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/static/css/stylesheet.css">
    <link rel="stylesheet" type="text/css" href="/static/css/chart_style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/static/chart.js"></script>
    <script src="static/data.js" defer></script>
  </head>


  <body>
    <h1>Van Control</h1>
    <!-- NAVBAR (include via Jinja) -->
    {% include 'asset_navbar.html' %}

    <h2>Climate Control Zone</h2>

    <!-- SLIDER CONTROLLER -->
    <label for="data-slider">Select Max Limit: <span id="slider-value">{{ max_limit }}</span></label>
    <input type="range" id="data-slider" min="100" max="10000" value="{{ max_limit }}" step="10">

    <!-- DATE SELECTOR -->
    <button id="day-prev">◀</button>
    <input type="date" id="day-picker">
    <button id="day-next">▶</button>
    <span id="day-label"></span>

    <!-- STATISTICS TABLE -->
    <h3>Sensor Statistics</h3>
    <div id="stats-container">
      <table>
	    <tr>
	      <td><p><strong>High-00</strong> <span id="stat-high-0">Loading...</span></p></td>
	      <td><p><strong>High-01</strong> <span id="stat-high-1">Loading...</span></p></td>
	      <td><p><strong>High-02</strong> <span id="stat-high-2">Loading...</span></p></td>
	    </tr>
	    <tr>
	      <td><p><strong>Low-00</strong> <span id="stat-low-0">Loading...</span></p></td>
	      <td><p><strong>Low-01</strong> <span id="stat-low-1">Loading...</span></p></td>
	      <td><p><strong>Low-02</strong> <span id="stat-low-2">Loading...</span></p></td>
	    </tr>
	    <tr>
	      <td><p><strong>Mean-00</strong> <span id="stat-mean-0">Loading...</span></p></td>
	      <td><p><strong>Mean-01</strong> <span id="stat-mean-1">Loading...</span></p></td>
	      <td><p><strong>Mean-02</strong> <span id="stat-mean-2">Loading...</span></p></td>
	    </tr>
      </table>
      
      <p><strong>Earliest time:</strong> <span id="stat-time-early">Loading...</span></p>
      <p><strong>Latest time:</strong> <span id="stat-time-late">Loading...</span></p>
    </div>

    <!-- CHART 1 -->
    <div class="chartMenu">
      <div class="chartCard">
	    <div class="chartBox">
          <canvas id="line-chart1"></canvas>
	    </div>
      </div>
    </div>

    <!-- CHART 2 -->
    <div class="chartMenu">
      <div class="chartCard">
	    <div class="chartBox">
          <canvas id="line-chart2"></canvas>
	    </div>
      </div>
    </div>

    <script>
      const labels = {{ labels| tojson }};
      const data1_1 = {{ data1_1| tojson }};
      const data1_2 = {{ data1_2| tojson }};
      const data1_3 = {{ data1_3| tojson }};
      const data2_1 = {{ data2_1| tojson }};
      const data2_2 = {{ data2_2| tojson }};
      const data2_3 = {{ data2_3| tojson }};

      // START - CHART
      const chart1 = new Chart(document.getElementById("line-chart1"), {
	      type: 'line',
	      data: {
              labels: labels,
              datasets: [
		          {
		              data: data1_1,
		              label: "Internal",
		              borderColor: "#3e95cd",
		              fill: false
		          },
		          {
		              data: data1_2,
		              label: "Living room",
		              borderColor: "#c45850",
		              fill: false
		          },
		          {
		              data: data1_3,
		              label: "Bedroom",
		              borderColor: "#8fed9c",
                      fill: false
		          }
              ]
	      },
	      options: {
              responsive: true,
              title: {
		          display: true,
		          text: 'Temperature data'
              },
              scales: {
		          x: {
		              ticks: {
			              maxTicksLimit: 20
		              }
                  },
                  // removed max limit because I fixed erroneous outlier sensors
                  //y: {
                  //     max: 35
                  //    }
              }
          }
      });
      // END - CHART

      // START - CHART
      const chart2 = new Chart(document.getElementById("line-chart2"), {
	      type: 'line',
	      data: {
              labels: labels,
              datasets: [
		          {
		              data: data2_1,
		              label: "Humidity 1",
		              borderColor: "#381ecf",
		              fill: false
		          },
		          {
		              data: data2_2,
		              label: "Humidity 2",
		              borderColor: "#c23f23",
		              fill: false
		          },
		          {
		              data: data2_3,
		              label: "Humidity 3",
		              borderColor: "#15d363",
		              fill: false
		          }
              ]
	      },
	      options: {
              responsive: true,
              plugins: {
		          title: {
		              display: true,
		              text: 'Humidity data'
		          }
              },
              scales: {
		          x: {
		              ticks: {
			              maxTicksLimit: 20
		              }
		          }
              }
	      }
      });
      // END - CHART


      // get reference to date picker
      const dayPicker = document.getElementById('day-picker');
      const dayPrev = document.getElementById('day-prev');
      const dayNext = document.getElementById('day-next');
      const dayLabel = document.getElementById('day-label');

      let selectedDay = new Date();

      // Get references to the slider and the label
      const slider = document.getElementById('data-slider');
      const sliderValue = document.getElementById('slider-value');
      const dataContainer = document.getElementById('data-container');
    </script>
  </body>
</html>
